version: '3.8'

# Development Docker Compose override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  backend:
    # Use local code with hot reload
    volumes:
      - ./backend:/app/backend
      - ./frontend:/app/frontend
      - ./storage:/app/storage

    # Development environment
    environment:
      ENVIRONMENT: development
      LOG_LEVEL: debug
      # Use SQLite for development (faster, simpler)
      DATABASE_URL: sqlite:///app/storage/database/docuflow.db

    # Enable hot reload
    command: ["uvicorn", "backend.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

    # Expose debugger port
    ports:
      - "8000:8000"
      - "5678:5678"  # Python debugger

  # Use SQLite instead of PostgreSQL for development (optional)
  db:
    profiles:
      - production  # Don't start in dev mode

  redis:
    profiles:
      - production  # Optional in dev mode

  frontend:
    volumes:
      - ./frontend:/usr/share/nginx/html
      # Mount dev nginx config (no SSL, permissive CORS)
      - ./nginx.dev.conf:/etc/nginx/conf.d/default.conf:ro
